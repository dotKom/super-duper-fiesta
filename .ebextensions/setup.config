container_commands:  
  01_install_yarn:
    command: |
      curl --silent --location https://rpm.nodesource.com/setup_8.x | sudo bash -
      curl --silent --location https://dl.yarnpkg.com/rpm/yarn.repo | sudo tee /etc/yum.repos.d/yarn.repo
      sudo yum -y install yarn
  02_build_frontend:
    command: yarn build:prod
  03_migrate:
    command: yarn db:migrate -- --url=$DATABASE_URL
    leader_only: true

option_settings:
  aws:elasticbeanstalk:cloudwatch:logs:
    StreamLogs: true
    DeleteOnTerminate: false
    RetentionInDays: 7
  aws:elasticbeanstalk:container:nodejs:
    NodeCommand: node server/server.js
    NodeVersion: 8.17.0
